<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ—¥æœ¬èªç·´ç¿’</title>
    <link rel="stylesheet" href="./css/practice.css?v=1.0.1">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body>
    <header>
        <div class="logo">Typing-Japanese</div>
        <div class="lesson-info-controls-wrapper">
            <div class="lesson-info">
                <span id="courseTitle">åŠ è½½ä¸­...</span>
            </div>
            <div class="controls">
                <button class="icon-button" onclick="window.practiceManager.playSound()">ğŸ”Š</button>
                <button class="icon-button" onclick="window.practiceManager.toggleSplitList()">ğŸ“š</button>
                <button class="icon-button">â˜€ï¸</button>
                <button class="icon-button" onclick="window.location.href='../index.html'" class="back-btn">è¿”å›é¦–é¡µ</button>
            </div>
        </div>
    </header>
    
    <!-- æ·»åŠ ä¾§è¾¹æ  -->
    <div class="sidebar" id="splitListSidebar">
        <div class="sidebar-header">
            <h3>åˆ†å¥ç»ƒä¹ åˆ—è¡¨</h3>
            <button class="close-button" onclick="window.practiceManager.toggleSplitList()">Ã—</button>
        </div>
        <div class="sidebar-content">
            <!-- è¿™é‡Œå°†é€šè¿‡ JavaScript åŠ¨æ€æ·»åŠ å†…å®¹ -->
        </div>
    </div>
    
    <main>
        <div class="practice-container">
            <!-- é—®é¢˜æ˜¾ç¤ºåŒºåŸŸ -->
            <div class="question-display">
                <div class="character"></div>
                <div class="input-area">
                    <input type="text" placeholder="è¾“å…¥ç­”æ¡ˆ..." />
                </div>
            </div>
            
            <!-- åŠŸèƒ½æŒ‰é’®ç»„ -->
            <div class="function-buttons">
                <button class="function-btn show-answer-btn" onclick="window.practiceManager.showCorrectAnswer(window.practiceManager.questions[window.practiceManager.currentQuestionIndex], true)">
                    <span class="btn-icon">ğŸ‘ï¸</span>
                    <span class="btn-text">æ˜¾ç¤ºç­”æ¡ˆ</span>
                    <span class="btn-shortcut">Tab</span>
                </button>
                <button class="function-btn play-sound-btn" onclick="window.practiceManager.playSound()">
                    <span class="btn-icon">ğŸ”Š</span>
                    <span class="btn-text">æ’­æ”¾å£°éŸ³</span>
                    <span class="btn-shortcut">Ctrl</span>
                </button>
                <button class="function-btn mark-mastered-btn" onclick="window.practiceManager.markAsMastered(window.practiceManager.questions[window.practiceManager.currentQuestionIndex])">
                    <span class="btn-icon">âœ“</span>
                    <span class="btn-text">æ ‡è®°æŒæ¡</span>
                    <span class="btn-shortcut">Alt+M</span>
                </button>
            </div>
            
            <!-- æ·»åŠ å†å²è®°å½•æ˜¾ç¤ºåŒºåŸŸ -->
            <div class="previous-question">
                <div class="previous-japanese"></div>
                <div class="previous-meaning"></div>
            </div>

            <!-- ç­”æ¡ˆæ˜¾ç¤ºåŒºåŸŸ -->
            <div class="answer-display">
                <div class="answer-content">
                    <div class="kanji-text"></div>
                    <div class="kana-text"></div>
                    <div class="romaji-text"></div>
                    <div class="meaning-text"></div>
                </div>
            </div>
        </div>
    </main>

    <!-- æ·»åŠ ç­”é¢˜å†å²é¢æ¿ -->
    <div class="history-panel">
        <div class="history-content">
            <!-- å†å²è®°å½•å°†é€šè¿‡JavaScriptåŠ¨æ€æ·»åŠ  -->
        </div>
    </div>

    <!-- ä½¿ç”¨ ES6 æ¨¡å—æ–¹å¼å¯¼å…¥è„šæœ¬ -->
    <script type="module" src="./js/common/utils.js"></script>
    <script type="module" src="./js/common/storage.js"></script>
    <script type="module" src="./js/dataLoader.js"></script>
    <script type="module" src="./js/practice.js?v=1.0.2"></script>

    <script>
        window.onerror = function(msg, url, lineNo, columnNo, error) {
            console.error('Error: ' + msg + '\nURL: ' + url + '\nLine: ' + lineNo + '\nColumn: ' + columnNo + '\nError object: ' + JSON.stringify(error));
            return false;
        };

        // è·å–URLå‚æ•°
        const urlParams = new URLSearchParams(window.location.search);
        const courseId = urlParams.get('course');
        const lessonId = urlParams.get('lesson');

        // æ ‡è®°è¯¾ç¨‹ä¸ºå·²å®Œæˆ
        function markLessonAsCompleted() {
            const completedLessons = JSON.parse(localStorage.getItem('completedLessons') || '{}');
            if (!completedLessons[courseId]) {
                completedLessons[courseId] = [];
            }
            if (!completedLessons[courseId].includes(lessonId)) {
                completedLessons[courseId].push(lessonId);
                localStorage.setItem('completedLessons', JSON.stringify(completedLessons));
            }
        }

        // åœ¨å®Œæˆè¯¾ç¨‹æ—¶è°ƒç”¨æ ‡è®°å‡½æ•°
        window.addEventListener('lessonCompleted', () => {
            markLessonAsCompleted();
        });

        // ç¡®ä¿é¡µé¢å®Œå…¨åŠ è½½åå†åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            // ä»courses.htmlä¸­è·å–è¯¾ç¨‹æ•°æ®
            fetch('courses.html')
                .then(response => response.text())
                .then(html => {
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(html, 'text/html');
                    const scriptContent = Array.from(doc.scripts)
                        .find(script => script.textContent.includes('courseData'))
                        ?.textContent;
                    
                    if (scriptContent) {
                        const courseDataMatch = scriptContent.match(/const courseData = ({[\s\S]*?});/);
                        if (courseDataMatch) {
                            const courseData = eval('(' + courseDataMatch[1] + ')');
                            const course = courseData[courseId];
                            if (course && course.lessons[lessonId]) {
                                document.getElementById('courseTitle').textContent = 
                                    `${course.name} - ${course.lessons[lessonId].title}`;
                                document.title = `${course.name} - ${course.lessons[lessonId].title}`;
                            }
                        }
                    }
                })
                .catch(error => {
                    console.error('Error loading course data:', error);
                    // å¦‚æœåŠ è½½å¤±è´¥ï¼Œæ˜¾ç¤ºåŸºæœ¬ä¿¡æ¯
                    document.getElementById('courseTitle').textContent = `${courseId} - ${lessonId}`;
                });
        });
    </script>
</body>
</html> 